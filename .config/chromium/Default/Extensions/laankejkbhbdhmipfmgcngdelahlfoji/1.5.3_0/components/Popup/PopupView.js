define(["core/Logger","core/CoreAPI","core/vendor/jquery.min","core/vendor/DropletJS.PubSub.min","core/vendor/Brightline.min","core/vendor/text!components/Popup/popup.tpl"],function(Logger,API,$,PubSub,Brightline,popupTpl){return API.Class.create({model:null,construct:function(model){this.model=model,PubSub.listen("Popup.timer.tick",this.updateDisplayTimer.bind(this))},init:function(){this.inject(),this.addListeners()},render:function(){var template=new Brightline(popupTpl);return template.set("baseDomain",this.model.baseDomain),template.set("fullDomain",this.model.fullDomain),template.render()},inject:function(){$("body").append(this.render()),API.Settings.get("hideAllowSiteLink")?$(".allow").hide():$("#allow-entire").show(),this.model.fullDomain!==this.model.baseDomain&&$(".only-allow, .only-block").show(),API.StayFocusd.localizeHTML(document),this.bindUIHandlers()},bindUIHandlers:function(){var self=this;$("#show-help").click(function(){PubSub.publish("PopupView.button.clicked",{button:"help"})}),$("#show-options").click(function(){PubSub.publish("PopupView.button.clicked",{button:"options"})}),$("#show-nuclear-option").click(function(){PubSub.publish("PopupView.button.clicked",{button:"nuclearOption"})}),$("a.close").click(function(){PubSub.publish("PopupView.button.clicked",{button:"close"})}),$("#showBlockedSitesOptions").click(function(){PubSub.publish("PopupView.button.clicked",{button:"blockedSites"})}),$("#show-advanced-options").click(function(){$("#advanced-options").slideToggle("fast")}),$("#block-entire").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:self.model.baseDomain,listType:"black"})}),$("#block-custom").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:$("#custom-url").val(),listType:"black"})}),$("#allow-custom").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:$("#custom-url").val(),listType:"white"})}),$("#allow-entire").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:self.model.baseDomain,listType:"white"})}),$("#only-block").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:self.model.fullDomain,listType:"black"})}),$("#only-allow").click(function(){PubSub.publish("PopupView.button.clicked",{button:"addToList",domain:self.model.fullDomain,listType:"white"})})},addListeners:function(){var self=this;PubSub.listen("*.domain.added",function(message,payload){self.showAddToListStatus(payload.success)}),PubSub.listen("PopupModel.timer.updated",function(message,payload){self.updateDisplayTimer(payload.timer)})},showAddToListStatus:function(success){success===!0?($("#status-msg").removeClass("error").addClass("success").html(API.Chrome.Translation.get("success").toUpperCase()+"!"),setTimeout(function(){window.close()},1500)):($("#status-msg").removeClass("success").addClass("error").html(API.Chrome.Translation.get("error").toUpperCase()),setTimeout(function(){$("#status-msg").hide()},2e3)),$("#status-msg").show()},updateDisplayTimer:function(timer){var displayTimer="";this.model.isNuclear()?(displayTimer=API.Chrome.Translation.get("nuclear"),$("#display-timer").addClass("nuclear")):this.model.isActive()===!1?displayTimer=API.Chrome.Translation.get("inactive"):(displayTimer=timer,"00:00:00"==displayTimer&&$("#display-timer").addClass("expired")),$("#display-timer").html(displayTimer)}})});