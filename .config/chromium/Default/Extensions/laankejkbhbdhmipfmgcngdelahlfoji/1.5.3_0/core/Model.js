define(["core/Logger","core/CoreAPI"],function(Logger,API){return API.Class.create({id:null,load:function(id,callback){var self=this,key=this.getStorageKey(id);this.id=id,API.Storage.get(key,function(data){self.hydrate(data),"function"==typeof callback&&callback(self)})},save:function(storageBucket,callback){if(!this.id)throw new Error("["+this.originator+".save()] Model must have an id before being saved");var data={},key=this.getStorageKey();data[key]=this.dehydrate(),API.Storage.set(data,callback,storageBucket)},update:function(data){for(var prop in data)data.hasOwnProperty(prop)&&(this[prop]=data[prop])},getStorageKey:function(id){return id=id||this.id,this.className+"_"+id},dehydrate:function(){var data={};for(var prop in this)this.hasOwnProperty(prop)&&"function"!=typeof this[prop]&&(data[prop]=this[prop]);return data},hydrate:function(data){this.update(data)}})});