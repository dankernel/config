define(["core/Logger","core/CoreAPI","core/vendor/DropletJS.Class.min"],function(Logger,API,Class){return Class.create({key:"",value:null,expiration:null,timer:null,done:!1,interval:60,construct:function(key){this.key=this.stripDelayedWritePrefix(key)},add:function(value,delayNum,delayUnit){var delay=API.Date.timeUnitToMilliseconds(delayNum,delayUnit),nowTime=(new Date).getTime();this.expiration=nowTime+delay,this.value=value,this.save()},save:function(){var key=this.getDelayedWriteKey(),obj={};obj[key]=JSON.stringify(this),API.Storage.set(obj)},load:function(){var key=this.getDelayedWriteKey(),json=API.Storage.get(key),obj=JSON.parse(json);this.revive(obj)},check:function(){!this.done&&this.isExpired()&&this.write()},write:function(){var obj={};obj[this.key]=JSON.stringify(this.value),API.Storage.set(obj),API.Storage.remove(this.getDelayedWriteKey()),this.done=!0},isExpired:function(){var nowTime=(new Date).getTime();return null!==this.expiration&&nowTime>this.expiration},getDelayedWriteKey:function(){return this.getDelayedWriteKeyPrefix()+this.key},getDelayedWriteKeyPrefix:function(){return"dw_"},stripDelayedWritePrefix:function(key){return 0===key.indexOf(this.getDelayedWriteKeyPrefix())?key.substr(this.getDelayedWriteKeyPrefix().length):key},toJSON:function(){return{key:this.key,value:this.value,expiration:this.expiration,done:this.done}}})});