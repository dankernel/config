define(["core/Logger"],function(Logger){var DomainParser={initAPI:function(API){API.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},getCurrentURL:function(){API.Chrome.Tab.getSelected(null,function(tab){return void 0!==tab?tab.url:void 0})},extractFullDomain:function(url){if(!url)return null;var matches=url.match(/:\/\/(.[^/]+)/);if(null==matches||matches.length<2){var urlArray=url.split("/");return urlArray[0]}return matches[1]},extractBaseDomain:function(url){var fullDomain=this.extractFullDomain(url);if(!fullDomain||0===fullDomain.length)return"";var domainArray=fullDomain.split(".");if(1===domainArray.length)return fullDomain;var baseDomain=domainArray[domainArray.length-1];return baseDomain=domainArray[domainArray.length-2]+"."+baseDomain,this.isMultiPartDomain(fullDomain)&&(baseDomain=domainArray[domainArray.length-3]+"."+baseDomain),baseDomain},isMultiPartDomain:function(fullDomain){var domainArray=fullDomain.split("."),domainTokens=[];if(1===domainArray.length)return!1;var penultimate=domainArray[domainArray.length-2];if(1==penultimate.length)return!0;if(2==penultimate.length&&domainArray.length>3)return!0;if(3==penultimate.length&&domainArray.length>=3){domainTokens=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"];for(var key in domainTokens)if(domainTokens.hasOwnProperty(key)&&penultimate==domainTokens[key])return!0}if(4==penultimate.length&&domainArray.length>=3){domainTokens=["info","mobi","name","jobs","kiwi","aero","asia","coop"];for(var key2 in domainTokens)if(domainTokens.hasOwnProperty(key2)&&penultimate==domainTokens[key2])return!0}if(domainArray.length>=3){var antepenultimate=domainArray[domainArray.length-3];if(2==penultimate.length&&3===domainArray.length&&antepenultimate.length>2&&"www"!==antepenultimate)return!0}return!1},isMoreGeneralURL:function(domainToCheck,domainToCompare){domainToCheck="string"==typeof domainToCheck?domainToCheck.toLowerCase():domainToCheck,domainToCompare="string"==typeof domainToCompare?domainToCompare.toLowerCase():domainToCompare;domainToCheck=this.stripProtocol(domainToCheck),domainToCompare=this.stripProtocol(domainToCompare);var baseDomainToCompare=this.extractBaseDomain(domainToCompare);if(domainToCheck===domainToCompare)return!0;if(domainToCheck===baseDomainToCompare)return!0;if(0===domainToCompare.indexOf(domainToCheck))return!0;var baseDomainToCheck=this.extractBaseDomain(domainToCheck);return baseDomainToCheck===baseDomainToCompare&&domainToCheck.length<=domainToCompare.length&&domainToCompare.indexOf(domainToCheck)>=0&&(domainToCompare.indexOf("/")>=0||domainToCompare.indexOf("?")>=0)?!0:baseDomainToCompare.length>baseDomainToCheck.length&&baseDomainToCompare.indexOf(domainToCheck)>-1?!0:!1},matchesWildcard:function(wildcard,domainToCompare){var rawWildcardString=wildcard.replace("*","");if(-1==domainToCompare.indexOf(rawWildcardString))return!1;var domainUpToWildcard=domainToCompare.substring(0,domainToCompare.indexOf(rawWildcardString)+rawWildcardString.length),domainSubstring=domainToCompare.substring(domainUpToWildcard.length-rawWildcardString.length,domainUpToWildcard.length),result=domainSubstring===rawWildcardString;return result},stripProtocol:function(url){return url.indexOf("://")>-1?url.slice(url.indexOf("://")+3,url.length):url}};return DomainParser});